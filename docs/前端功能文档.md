# 前端功能文档

## 技术架构

### 核心技术
- **Vue 3.5.18**: 使用Composition API开发
- **TypeScript**: 类型安全的开发体验
- **Vite 7.0**: 快速的构建工具
- **Tailwind CSS 4.0**: 原子化CSS框架
- **Anime.js 4.2.2**: 强大的动画库
- **Axios**: HTTP请求库

## 项目结构

```
frontend/
├── src/
│   ├── api/           # API接口封装
│   │   └── index.ts   # 统一的API请求方法
│   ├── assets/        # 静态资源
│   │   └── images/    # 图片资源
│   ├── components/    # 通用组件
│   │   ├── ChildCard.vue         # 小朋友卡片组件
│   │   ├── ChildFormModal.vue    # 小朋友表单弹窗
│   │   ├── StarModal.vue         # 星星操作弹窗
│   │   ├── RewardFormModal.vue   # 奖品表单弹窗
│   │   └── RedeemModal.vue       # 兑换操作弹窗
│   ├── composables/   # 组合式函数
│   │   └── useApi.ts  # API钩子函数
│   ├── router/        # 路由配置
│   │   └── index.ts   # 路由定义
│   ├── types/         # TypeScript类型定义
│   │   └── index.ts   # 数据模型接口
│   ├── utils/         # 工具函数
│   │   └── format.ts  # 格式化工具
│   ├── views/         # 页面组件
│   │   ├── HomePage.vue      # 首页
│   │   ├── ChildDetail.vue   # 小朋友详情页
│   │   └── RewardList.vue    # 奖品列表页
│   ├── App.vue        # 根组件
│   ├── main.ts        # 应用入口
│   └── style.css      # 全局样式
├── public/            # 公共资源
├── index.html         # HTML模板
└── vite.config.ts     # Vite配置
```

## 核心组件详解

### 1. 页面组件 (Views)

#### HomePage.vue - 首页
**功能描述**：
- 展示所有小朋友的卡片列表
- 提供添加新小朋友的入口
- 快速访问各个功能模块

**主要特性**：
- 响应式网格布局（Grid）
- 卡片悬浮效果
- 快速操作按钮
- 空状态提示

**数据流**：
- 获取小朋友列表 (GET /api/children)
- 实时更新星星数量
- 路由跳转到详情页

#### ChildDetail.vue - 小朋友详情页
**功能描述**：
- 显示个人详细信息
- 星星加减操作
- 查看历史记录
- 编辑和删除功能

**页面布局**：
1. 头部信息区
   - 头像显示
   - 基本信息（姓名、年龄、性别）
   - 当前星星数（大字体突出）
2. 操作按钮区
   - 加星星按钮（绿色）
   - 减星星按钮（红色）
   - 编辑信息按钮
   - 删除按钮
3. 历史记录区
   - 时间轴展示
   - 操作类型标识
   - 变动数量显示

**动画效果**：
- 页面进入过渡动画
- 星星数字变化动画
- 操作成功反馈动画

#### RewardList.vue - 奖品列表页
**功能描述**：
- 展示所有奖品
- 按小朋友筛选
- 创建新奖品
- 兑换操作入口

**页面特性**：
- 筛选器组件
- 奖品卡片网格
- 进度条展示
- 兑换状态标识

**交互设计**：
- 卡片点击查看详情
- 长按显示操作菜单
- 滑动刷新列表
- 下拉加载更多

### 2. 通用组件 (Components)

#### ChildCard.vue - 小朋友卡片
**组件属性**：
```typescript
interface Props {
  child: {
    id: number
    name: string
    avatar?: string
    starCount: number
    gender: 'boy' | 'girl'
  }
}
```

**功能特性**：
- 头像展示（支持默认头像）
- 星星数量醒目显示
- 性别标识（颜色区分）
- 点击跳转详情页

**样式设计**：
- 圆角卡片
- 阴影效果
- 悬浮放大
- 渐变背景

#### ChildFormModal.vue - 小朋友表单弹窗
**表单字段**：
- 姓名（必填）
- 生日（日期选择器）
- 性别（单选按钮）
- 头像（图片上传）

**功能实现**：
- 表单验证
- 图片预览
- 图片裁剪
- 提交处理

**用户体验**：
- 实时验证反馈
- 加载状态显示
- 错误提示
- 成功动画

#### StarModal.vue - 星星操作弹窗
**操作类型**：
- 加星星模式
- 减星星模式

**界面元素**：
- 数量输入框
- 快捷按钮（+1, +5, +10）
- 原因输入框
- 确认/取消按钮

**动画效果**：
```javascript
// 加星动画
anime({
  targets: '.star-icon',
  translateY: [-50, 0],
  opacity: [0, 1],
  scale: [0, 1],
  duration: 800,
  easing: 'easeOutElastic(1, 0.8)'
})

// 减星动画
anime({
  targets: '.star-icon',
  translateY: [0, 50],
  opacity: [1, 0],
  scale: [1, 0],
  duration: 600,
  easing: 'easeInQuad'
})
```

#### RewardFormModal.vue - 奖品表单弹窗
**表单设计**：
- 奖品名称
- 奖品图片上传
- 所需星星数
- 选择关联的小朋友（多选）
- 奖品描述

**特色功能**：
- 图片拖拽上传
- 多选框组件
- 星星数预览
- 表单自动保存

#### RedeemModal.vue - 兑换弹窗
**兑换流程**：
1. 显示奖品信息
2. 列出关联的小朋友
3. 编辑每人扣除数量
4. 余额校验
5. 确认兑换
6. 播放庆祝动画

**动画序列**：
```javascript
// 兑换成功动画
async function playRedeemAnimation() {
  // 1. 卡片翻转
  await anime({
    targets: '.reward-card',
    rotateY: '180deg',
    duration: 600
  }).finished

  // 2. 烟花效果
  launchFireworks()

  // 3. 纸屑飘落
  confetti({
    particleCount: 100,
    spread: 70,
    origin: { y: 0.6 }
  })

  // 4. 成功提示
  showSuccessMessage()
}
```

## 状态管理

### 响应式数据
使用Vue 3的响应式API：
```typescript
// 使用ref管理基础类型
const starCount = ref<number>(0)

// 使用reactive管理对象
const childData = reactive({
  name: '',
  birthday: '',
  gender: 'boy'
})

// 计算属性
const age = computed(() => {
  return calculateAge(childData.birthday)
})
```

### 组件通信
- **Props/Emit**: 父子组件通信
- **Provide/Inject**: 跨层级组件通信
- **Event Bus**: 兄弟组件通信（少用）

## API集成

### 请求封装
```typescript
// api/index.ts
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:8000/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 请求拦截器
apiClient.interceptors.request.use(config => {
  // 添加token等
  return config
})

// 响应拦截器
apiClient.interceptors.response.use(
  response => response.data,
  error => {
    // 统一错误处理
    ElMessage.error(error.message)
    return Promise.reject(error)
  }
)
```

### 接口调用示例
```typescript
// 获取小朋友列表
export const getChildren = () => apiClient.get('/children')

// 添加星星
export const addStars = (childId: number, data: AddStarsDto) => 
  apiClient.post(`/children/${childId}/stars/add`, data)

// 兑换奖品
export const redeemReward = (rewardId: number, data: RedeemDto) =>
  apiClient.post(`/rewards/${rewardId}/redeem`, data)
```

## 动画系统

### Anime.js集成
主要用于：
- 数字变化动画
- 元素进入/离开动画
- 星星飞行轨迹
- 卡片翻转效果

### CSS动画
使用Tailwind CSS的动画类：
```css
/* 脉冲动画 */
.animate-pulse

/* 弹跳动画 */
.animate-bounce

/* 旋转动画 */
.animate-spin

/* 自定义动画 */
@keyframes float {
  0%, 100% { transform: translateY(0px) }
  50% { transform: translateY(-20px) }
}
```

## 响应式设计

### 断点设置
```css
/* Tailwind默认断点 */
sm: 640px   /* 手机横屏 */
md: 768px   /* 平板竖屏 */
lg: 1024px  /* 平板横屏 */
xl: 1280px  /* 桌面 */
2xl: 1536px /* 大屏幕 */
```

### 自适应布局
- 首页：1-4列自适应网格
- 详情页：单列居中布局
- 奖品页：2-5列自适应网格

## 性能优化

### 代码分割
```typescript
// 路由懒加载
const ChildDetail = () => import('./views/ChildDetail.vue')
const RewardList = () => import('./views/RewardList.vue')
```

### 图片优化
- 懒加载实现
- WebP格式支持
- 响应式图片
- 缩略图预加载

### 缓存策略
- API响应缓存
- 静态资源缓存
- 组件缓存（keep-alive）

## 开发规范

### 命名规范
- 组件：PascalCase（如 ChildCard）
- 函数：camelCase（如 handleClick）
- 常量：UPPER_CASE（如 MAX_STARS）
- CSS类：kebab-case（如 star-container）

### 目录规范
- 一个组件一个文件夹
- 相关样式放在同一文件夹
- 测试文件使用.spec.ts后缀

### Git提交规范
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码格式
- refactor: 重构
- test: 测试相关
- chore: 构建相关
